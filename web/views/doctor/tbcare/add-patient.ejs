<%- include('../../includes/head.ejs') %>
</head>
<body>
   <div class="wrapper">
      <%- include('../../includes/navigations-tbcare.ejs') %>
      <div id="content-page" class="content-page">
         <%- include('../../includes/top-navbar.ejs') %>
         <div class="container-fluid">
            <div class="row">
               <div class="col-lg-12">
                  <div class="iq-card">
                     <div class="iq-card-header d-flex justify-content-between">
                        <div class="iq-header-title">
                           <h4 class="card-title"><%= pageHeader %></h4>
                        </div>
                     </div>
                     <div class="iq-card-body">
                        <form action='/sub_1/create-patient?_csrf=<%= csrfToken %>' method='post'>
                           
                           <h5 class="mb-3">Clinical Data</h5>
                           <div class="row">
                              <div class="form-group col-md-4"><label>Age:</label><input type="number" class="form-control" name="age" required></div>
                              <div class="form-group col-md-4"><label>Sex:</label><select class="form-control" name="sex" required><option value="Male">Male</option><option value="Female">Female</option></select></div>
                              <div class="form-group col-md-3"><label>Height (cm):</label><input type="number" step="0.1" class="form-control" id="height" name="height"></div>
                              <div class="form-group col-md-3"><label>Weight (Kg):</label><input type="number" step="0.1" class="form-control" id="weight" name="weight"></div>
                              <div class="form-group col-md-3"><label>BMI:</label><input type="text" class="form-control" id="bmi" name="bmi" readonly></div>
                              <div class="form-group col-md-3"><label>Weight Status:</label><input type="text" class="form-control" id="weightStatus" name="weightStatus" readonly></div>
                           </div>
                           <hr>

                           <h5 class="mb-3">Symptoms</h5>
                           <div class="row">
                              <div class="form-group col-md-4"><label>Productive Cough:</label><select class="form-control" id="isCoughProductive" name="isCoughProductive"><option value="No">No</option><option value="Yes">Yes</option></select></div>
                              <div class="form-group col-md-8" id="coughDurationContainer" style="display: none;"><label>Cough Duration (days):</label><input type="number" class="form-control" name="coughDurationDays"></div>
                              <div class="form-group col-md-4"><label>Weight Loss:</label><select class="form-control" id="hasWeightLoss" name="hasWeightLoss"><option value="No">No</option><option value="Yes">Yes</option></select></div>
                              <div class="form-group col-md-8" id="weightLossAmountContainer" style="display: none;"><label>Weight Loss Amount (Kg):</label><input type="number" step="0.1" class="form-control" name="weightLossAmountKg"></div>
                              <div class="form-group col-md-3"><label>Hemoptysis:</label><select class="form-control" name="hasHemoptysis"><option value="No">No</option><option value="Yes">Yes</option></select></div>
                              <div class="form-group col-md-3"><label>Chest Pain:</label><select class="form-control" name="hasChestPain"><option value="No">No</option><option value="Yes">Yes</option></select></div>
                              <div class="form-group col-md-3"><label>Short Breath:</label><select class="form-control" name="hasShortBreath"><option value="No">No</option><option value="Yes">Yes</option></select></div>
                              <div class="form-group col-md-3"><label>Fever:</label><select class="form-control" name="hasFever"><option value="No">No</option><option value="Yes">Yes</option></select></div>
                              <div class="form-group col-md-3"><label>Night Sweats:</label><select class="form-control" name="hasNightSweats"><option value="No">No</option><option value="Yes">Yes</option></select></div>
                           </div>
                           <hr>
                           
                           <h5 class="mb-3">History</h5>
                           <div class="row">
                              <div class="form-group col-md-4"><label>Prior TB:</label><select class="form-control" name="hadPriorTB"><option value="No">No</option><option value="Yes">Yes</option></select></div>
                              <div class="form-group col-md-8"><label>Tobacco Use:</label><select class="form-control" id="tobaccoUse" name="tobaccoUse"><option value="never">Never</option><option value="current">Current</option><option value="stopped">Stopped</option><option value="not disclosed">Not Disclosed</option></select></div>
                           </div>
                           <div class="row" id="tobaccoDetailsContainer" style="display: none;">
                                <div class="form-group col-md-4" id="cigarettesPerDayContainer"><label>Cigarettes/Day:</label><input type="number" name="cigarettesPerDay" class="form-control"></div>
                                <div class="form-group col-md-4" id="smokingSinceContainer"><label>Smoking Since (months):</label><input type="number" name="smokingSinceMonths" class="form-control"></div>
                                <div class="form-group col-md-4" id="stoppedSmokingContainer"><label>Stopped Smoking Since (months):</label><input type="number" name="stoppedSmokingMonths" class="form-control"></div>
                           </div>
                           <hr>

                           <h5 class="mb-3">Comorbidity History</h5>
                           <div class="form-group">
                                <div class="custom-control custom-checkbox"><input type="checkbox" class="custom-control-input" id="cb-diabet" name="comorbidities" value="Diabet"><label class="custom-control-label" for="cb-diabet">Diabet</label></div>
                                <div class="custom-control custom-checkbox"><input type="checkbox" class="custom-control-input" id="cb-hipertensi" name="comorbidities" value="Hipertensi"><label class="custom-control-label" for="cb-hipertensi">Hipertensi</label></div>
                                <div class="custom-control custom-checkbox"><input type="checkbox" class="custom-control-input" id="cb-kencingmanis" name="comorbidities" value="Kencing Manis"><label class="custom-control-label" for="cb-kencingmanis">Kencing Manis</label></div>
                                <div class="custom-control custom-checkbox"><input type="checkbox" class="custom-control-input" id="cb-gagalginjal" name="comorbidities" value="Gagal Ginjal"><label class="custom-control-label" for="cb-gagalginjal">Gagal Ginjal</label></div>
                                <div class="custom-control custom-checkbox"><input type="checkbox" class="custom-control-input" id="cb-rematik" name="comorbidities" value="Rematik"><label class="custom-control-label" for="cb-rematik">Rematik</label></div>
                                <div class="custom-control custom-checkbox"><input type="checkbox" class="custom-control-input" id="cb-stroke" name="comorbidities" value="Stroke"><label class="custom-control-label" for="cb-stroke">Stroke</label></div>
                                <div class="custom-control custom-checkbox"><input type="checkbox" class="custom-control-input" id="cb-gerd" name="comorbidities" value="GERD"><label class="custom-control-label" for="cb-gerd">GERD</label></div>
                                <div class="form-group mt-2"><label>Other:</label><input type="text" class="form-control" name="comorbiditiesOther" placeholder="Sebutkan penyakit lain..."></div>
                           </div>
                           <hr>
                           
                           <h5 class="mb-3">Patient Identity & Account</h5>
                           <div class="row">
                              <div class="form-group col-md-6"><label>First Name:</label><input type="text" class="form-control" name="fname" required></div>
                              <div class="form-group col-md-6"><label>Last Name:</label><input type="text" class="form-control" name="lname" required></div>
                              <div class="form-group col-md-6"><label>Address:</label><input type="text" class="form-control" name="add1" required></div>
                              <div class="form-group col-md-6"><label>City:</label><input type="text" class="form-control" name="city" required></div>
                              <div class="form-group col-md-6"><label>Mobile Number:</label><input type="text" class="form-control" name="mobno" required></div>
                              <div class="form-group col-md-6"><label>Email:</label><input type="email" class="form-control" name="email" required></div>
                              <div class="form-group col-md-4"><label>Username:</label><input type="text" class="form-control" name="uname" required></div>
                              <div class="form-group col-md-4"><label>Password:</label><input type="password" class="form-control" name="pass" required></div>
                              <div class="form-group col-md-4"><label>Repeat Password:</label><input type="password" class="form-control" name="rpass" required></div>
                           </div>
                           <hr>

                           <a href="/sub_1/doctor" class="btn iq-bg-danger">Cancel</a>
                           <button type="submit" class="btn btn-primary">Add New Patient</button>
                        </form>
                     </div>
                  </div>
               </div>
            </div>
         </div>
         <%- include('../../includes/footer.ejs') %>
      </div>
   </div>
   <%- include('../../includes/end.ejs') %>

   <script>
      document.addEventListener('DOMContentLoaded', function() {
          // BMI Calculator
          const heightInput = document.getElementById('height');
          const weightInput = document.getElementById('weight');
          const bmiInput = document.getElementById('bmi');
          const weightStatusInput = document.getElementById('weightStatus');

          function calculateBmi() {
              const height = parseFloat(heightInput.value);
              const weight = parseFloat(weightInput.value);

              if (height > 0 && weight > 0) {
                  const heightInMeters = height / 100;
                  const bmi = weight / (heightInMeters * heightInMeters);
                  bmiInput.value = bmi.toFixed(2);

                  // Determine weight status
                  if (bmi < 18.5) {
                      weightStatusInput.value = 'Underweight';
                  } else if (bmi >= 18.5 && bmi < 24.9) {
                      weightStatusInput.value = 'Normal';
                  } else if (bmi >= 25 && bmi < 29.9) {
                      weightStatusInput.value = 'Overweight';
                  } else {
                      weightStatusInput.value = 'Obese';
                  }
              } else {
                  bmiInput.value = '';
                  weightStatusInput.value = '';
              }
          }
          heightInput.addEventListener('input', calculateBmi);
          weightInput.addEventListener('input', calculateBmi);

          // Conditional Cough Duration
          const isCoughProductiveSelect = document.getElementById('isCoughProductive');
          const coughDurationContainer = document.getElementById('coughDurationContainer');
          isCoughProductiveSelect.addEventListener('change', function() {
              coughDurationContainer.style.display = this.value === 'Yes' ? 'block' : 'none';
          });

          // Conditional Weight Loss Amount
          const hasWeightLossSelect = document.getElementById('hasWeightLoss');
          const weightLossAmountContainer = document.getElementById('weightLossAmountContainer');
          hasWeightLossSelect.addEventListener('change', function() {
              weightLossAmountContainer.style.display = this.value === 'Yes' ? 'block' : 'none';
          });

          // Conditional Tobacco Details
          const tobaccoUseSelect = document.getElementById('tobaccoUse');
          const tobaccoDetailsContainer = document.getElementById('tobaccoDetailsContainer');
          const cigarettesPerDayContainer = document.getElementById('cigarettesPerDayContainer');
          const smokingSinceContainer = document.getElementById('smokingSinceContainer');
          const stoppedSmokingContainer = document.getElementById('stoppedSmokingContainer');
          
          tobaccoUseSelect.addEventListener('change', function() {
              const value = this.value;
              if (value === 'current' || value === 'stopped') {
                  tobaccoDetailsContainer.style.display = 'flex'; // Use flex for row display
                  cigarettesPerDayContainer.style.display = value === 'current' ? 'block' : 'none';
                  smokingSinceContainer.style.display = value === 'current' ? 'block' : 'none';
                  stoppedSmokingContainer.style.display = value === 'stopped' ? 'block' : 'none';
              } else {
                  tobaccoDetailsContainer.style.display = 'none';
              }
          });
      });
   </script>
</body>
</html>