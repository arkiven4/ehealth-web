<% const isActive = (path) => { // This logic helps determine the active page. Adjust the paths if needed. if (path === 'dashboard' && pageTitle.includes('Dashboard')) return 'active'; if (path === 'add' && pageTitle.includes('Add
Patient')) return 'active'; if (path === 'history' && pageTitle.includes('History')) return 'active'; if (path === 'predict' && pageTitle.includes('Prediction')) return 'active'; return ''; }; const isPatientSectionActive = isActive('add')
|| isActive('history'); %>

<style>
  :root {
    --primary-color: #0d9488;
    --primary-color-soft: #e6fffa;
    --primary-color-hover: #ccfbf1;

    --text-strong: #1e293b;
    --text-medium: #475569; /* This is a good, visible gray */
    --text-soft: #94a3b8;

    --sidebar-bg: #ffffff;
    --sidebar-border: #e2e8f0;

    --sidebar-accent: #0d9488;
    --sidebar-accent-soft: rgba(13, 148, 136, 0.12);

    --radius: 12px;
    --transition: 0.22s ease;
  }

  .iq-sidebar {
    background: var(--sidebar-bg);
    border-right: 1px solid var(--sidebar-border);
    box-shadow: 2px 0 8px rgba(0, 0, 0, 0.03);
  }

  /* Logo section */
  .iq-sidebar-logo {
    padding: 26px 22px;
    border-bottom: 1px solid var(--sidebar-border);
  }
  .iq-sidebar-logo a {
    display: flex;
    gap: 12px;
    align-items: center;
    text-decoration: none;
  }
  .iq-sidebar-logo span {
    font-family: "Poppins", sans-serif;
    font-weight: 600;
    font-size: 1.45rem;
    color: var(--text-strong);
  }

  /* Menu */
  .iq-sidebar-menu .iq-menu {
    padding: 5px 18px;
  }

  .iq-menu-title {
    background: #f8fafc;
    padding: 12px 18px;
    border-radius: 10px;
    margin-bottom: 10px;
    color: var(--text-medium); /* UPDATED: Was --text-soft, now darker */
    font-size: 0.78rem;
    text-transform: uppercase;
    letter-spacing: 0.6px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .iq-menu-title i {
    color: var(--text-medium); /* UPDATED: Was --text-soft, now darker */
    font-size: 1rem;
  }

  .iq-menu-title span {
    color: var(--text-medium); /* Ensure span inherits visible color */
  }

  .iq-sidebar-menu .iq-menu li {
    margin-bottom: 6px;
  }

  /* Menu item */
  .iq-sidebar-menu .iq-menu li a {
    font-family: "Poppins", sans-serif;
    color: var(--text-medium);
    padding: 12px 16px;
    border-radius: var(--radius);
    display: flex;
    align-items: center;
    gap: 14px;
    transition: background var(--transition), color var(--transition), transform var(--transition);
  }

  .iq-sidebar-menu .iq-menu li a i {
    font-size: 1.35rem;
    color: var(--text-soft);
    transition: color var(--transition);
  }

  /* Hover */
  .iq-sidebar-menu .iq-menu li a:hover {
    background: var(--primary-color-soft);
    color: var(--sidebar-accent);
    transform: translateX(2px);
  }
  .iq-sidebar-menu .iq-menu li a:hover i {
    color: var(--sidebar-accent);
  }

  /* Active state */
  .iq-sidebar-menu .iq-menu li.active > a {
    background: var(--sidebar-accent-soft);
    color: var(--sidebar-accent);
    font-weight: 600;
    box-shadow: inset 0 0 0 1px rgba(13, 148, 136, 0.18);
  }
  .iq-sidebar-menu .iq-menu li.active > a i {
    color: var(--sidebar-accent);
  }

  /* Submenu */
  .iq-sidebar-menu .iq-menu ul {
    padding-left: 28px;
    margin-top: 8px;
    border-left: 2px solid var(--primary-color-hover);
  }

  .iq-sidebar-menu .iq-menu ul li a {
    padding: 10px 14px;
    font-size: 0.9rem;
  }

  .iq-sidebar-menu .iq-menu ul li a::before {
    content: "";
    width: 6px;
    height: 6px;
    background: var(--primary-color-hover);
    border-radius: 50%;
    margin-right: 14px;
    transition: background var(--transition);
  }

  .iq-sidebar-menu .iq-menu ul li.active a {
    background: transparent;
    color: var(--sidebar-accent);
    font-weight: 600;
  }
  .iq-sidebar-menu .iq-menu ul li.active a::before {
    background: var(--sidebar-accent);
  }

  /* Toggle icon */
  .right-icon {
    margin-left: auto;
    transition: transform var(--transition), color var(--transition);
    color: var(--text-soft);
  }
  .iq-sidebar-menu .iq-menu li a[aria-expanded="true"] .right-icon {
    transform: rotate(90deg);
    color: var(--sidebar-accent);
  }
</style>

<div class="iq-sidebar">
  <div class="iq-sidebar-logo d-flex justify-content-between">
    <a href="/tbcare/doctor">
      <img src="/images/tbcare_landing/logo.png" class="img-fluid" alt="TBCare Logo" style="height: 50px; width: auto; padding-left: 7%" />
    </a>
  </div>
  <div id="sidebar-scrollbar">
    <nav class="iq-sidebar-menu">
      <ul id="iq-sidebar-toggle" class="iq-menu">
        <!-- UPDATED: Removed text-black class, CSS will handle it -->
        <li class="iq-menu-title"><i class="ri-separator"></i><span data-i18n="menu.mainMenu">Main Menu</span></li>

        <li class="<%= isActive('dashboard') %>">
          <a href="/sub_1/doctor" class="iq-waves-effect"> <i class="ri-home-4-line"></i><span data-i18n="menu.dashboard">Dashboard</span> </a>
        </li>

        <li class="<%= isPatientSectionActive ? 'active' : '' %>">
          <a href="#patient-submenu" class="iq-waves-effect" data-toggle="collapse" aria-expanded="<%= isPatientSectionActive ? 'true' : 'false' %>">
            <i class="ri-group-line"></i>
            <span data-i18n="menu.patient">Patient</span>
            <i class="ri-arrow-right-s-line right-icon"></i>
          </a>
          <ul id="patient-submenu" class="collapse <%= isPatientSectionActive ? 'show' : '' %> iq-submenu" data-parent="#iq-sidebar-toggle">
            <li class="<%= isActive('add') %>">
              <a href="/sub_1/add-patient"><i class="ri-user-add-line"></i><span data-i18n="menu.addPatient">Add Patient</span></a>
            </li>
            <li class="<%= isActive('history') %>">
              <a href="/tbcare/patient-history"><i class="ri-file-text-line"></i><span data-i18n="menu.patientHistory">Patient History</span></a>
            </li>
          </ul>
        </li>

        <li class="<%= isActive('predict') %>">
          <a href="/tbcare/predict" class="iq-waves-effect"> <i class="ri-heart-pulse-line"></i><span data-i18n="menu.startPrediction">Start Prediction</span> </a>
        </li>
      </ul>
    </nav>
    <div class="p-3"></div>
  </div>
</div>

<script>
  (function () {
    try {
      const path = window.location.pathname || "";
      const patientToggle = document.querySelector('a[href="#patient-submenu"]');
      const submenu = document.getElementById("patient-submenu");
      if (!patientToggle || !submenu) return;

      // Jika URL menunjukkan add-patient atau patient-history -> buka submenu
      if (/add-patient|patient-history|\/tbcare\/patient-history|\/sub_1\/add-patient/.test(path)) {
        submenu.classList.add("show");
        patientToggle.setAttribute("aria-expanded", "true");
        const parentLi = patientToggle.closest("li");
        if (parentLi) parentLi.classList.add("active");

        // Tandai item spesifik sebagai active
        if (/add-patient/.test(path)) {
          const addLi = submenu.querySelector('a[href="/sub_1/add-patient"]')?.closest("li");
          if (addLi) addLi.classList.add("active");
        }
        if (/patient-history/.test(path)) {
          const histLi = submenu.querySelector('a[href="/tbcare/patient-history"]')?.closest("li");
          if (histLi) histLi.classList.add("active");
        }
      }
    } catch (e) {
      // silent
    }
  })();
</script>
